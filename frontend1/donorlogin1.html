<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Registration</title>
    <style>
        body {
            background-image: url('img9.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    font-family: Arial, sans-serif;
    background-color: #f0f0f0;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    height: 100%;
        }

        .header {
              display: flex;
              align-items: center;
              justify-content: center; /* Centers the heading horizontally */
              position: relative; /* Allows positioning of the logo */
              height: 80px;
              background-color: #e74c3c;
              color: white;
              padding: 0 20px;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
           }

           .logo {
                position: absolute; /* Positions the logo independently */
                left: 20px; /* Aligns the logo to the leftmost corner */
              }

           .logo img {
                 height: 50px; /* Adjusts the logo size */
             }

           .heading {
                 margin: 0;
                 font-size: 24px;
                 font-weight: bold;
              }
              
              /* Navigation styles */
             nav ul {
               display: flex;
               list-style: none;
               gap: 15px;
               margin: 0;
               padding: 0;      
             }           

              nav ul li a {
                 text-decoration: none;
                 color: #333;
                font-weight: bold;
               }
                
               /* Navigation section*/
               * {
                  padding: 0;
                  margin: 0;
                  font-family:'Poppins', sans-serif;
                }
                ul {
                  list-style:none;
                  background:#333;
                }
                ul li {
                  display: inline-block;
                  position: relative;
                }
                ul li a {
                  display: block;
                  padding: 10px 10px;
                  color:#FFF;
                  text-decoration: none;
                  text-align: center;
                  font-size: 20px;
               }
               ul li ul.dropdown li {
                  display: block;
               }
               ul li ul.dropdown  {
                  width: 100%;
                  background: #808080;
                  position: absolute;
                  z-index: 999;
                  display: none;
               }
               ul li a:hover {
                  background: #463f3f;
               }
               ul li:hover ul.dropdown {
                  display: block;
               }
               main {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}


        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            width: 300px; text-align: center; 
        }

        input { width: 90%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { width: 100%; padding: 10px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .hidden { display: none; }

        footer { 
                    background-color: #333; 
                    color: white; 
                    text-align: center; 
                    padding: 20px 0; 
                    } 
    </style>
</head>
<body>
    
    <header class="header">
        <div class="logo">
            <img src="logo.png" alt="Logo">
        </div>
        
        <h1 class="heading">Central Blood Bank</h1>
    </header>
       
       <ul>
         <li><a href="home.html">Home</a></li>
         <li>
           <a href="#">About us</a>
           <ul class="dropdown">
                <li><a href="abouttt.html">About us</a></li>
                <li><a href="factt.html">Facts</a></li>
                <li><a href="gallery.html">Photo gallery</a></li> 
                <li><a href ="videogallery.html">Video gallery</a></li>
                <li><a href="Looking.html">Know Us</a></li> 
                <li><a href="FAQS1.html">FAQs</a></li>
          </ul>
        </li>
        <li>
           <a href="#">Looking for blood</a>
           <ul class="dropdown">
                <li><a href="BloodAvailability1.html">Blood Availability</a></li>
                <li><a href="bloodbankdirectory.html">Blood Bank Directory</a></li> 
                <li><a href="donordetails.html">Search Donor</a></li> 
                
          </ul>
        
        </li>
        <li>
           <a href="#">Donor </a>
           <ul class="dropdown">
              <li><a href="register1.html">Donor register</a></li>
              <li><a href="donorlogin1.html">Donor login</a></li> 
              
        </ul>
      </li>
        <li><a href="request1.html">Request Blood</a></li>
        <li><a href="#">Blood Bank Login</a>
        <ul class="dropdown">
           <li><a href="bloodbanklogin.html">Blood Bank Login</a></li>
           <li><a href="bloodbankregistration.html ">Add Your Blood Bank</a></li> 
        </ul>
         
     </ul>



     <main>
        <div class="container" id="loginBox">
            <h2>Login</h2>
            <input type="email" id="loginEmail" placeholder="Email Address">
            <input type="password" id="loginPassword" placeholder="Password">
            <p><a href="#" onclick="showForgotPassword()">Forgot Password?</a></p>
            <button onclick="login()">Login</button>
            <p>Don't have an account? <a href="#" onclick="showRegister()">Register now</a></p>
        </div>
    
        <div class="container hidden" id="registerBox">
            <h2>Register</h2>
            <input type="email" id="registerEmail" placeholder="Email Address">
            <input type="password" id="registerPassword" placeholder="Password">
            <input type="password" id="confirmPassword" placeholder="Confirm Password">
            <button onclick="register()">Register</button>
            <p>Already have an account? <a href="#" onclick="showLogin()">Login now</a></p>
        </div>
    
        <div class="container hidden" id="forgotPasswordBox">
            <h2>Reset Password</h2>
            <input type="email" id="resetEmail" placeholder="Enter your email">
            <button onclick="sendResetCode()">Send Reset Code</button>
            <input type="text" id="resetCode" class="hidden" placeholder="Enter Reset Code">
            <input type="password" id="newPassword" class="hidden" placeholder="New Password">
            <button onclick="resetPassword()" class="hidden" id="resetBtn">Reset Password</button>
            <p><a href="#" onclick="showLogin()">Back to Login</a></p>
        </div>
    </main>
    
    <footer>
        <p>&copy; 2025 Central Blood Bank | All Rights Reserved</p> 
    </footer>
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const apiBaseUrl = "http://localhost:5000/api/donorAuth"; // Ensure backend is running
    
        // Show Register Form
        function showRegister() {
            document.getElementById('loginBox')?.classList.add('hidden');
            document.getElementById('registerBox')?.classList.remove('hidden');
            document.getElementById('forgotPasswordBox')?.classList.add('hidden');
        }
    
        // Show Login Form
        function showLogin() {
            document.getElementById('registerBox')?.classList.add('hidden');
            document.getElementById('forgotPasswordBox')?.classList.add('hidden');
            document.getElementById('loginBox')?.classList.remove('hidden');
        }
    
        // Show Forgot Password Form
        function showForgotPassword() {
            document.getElementById('loginBox')?.classList.add('hidden');
            document.getElementById('forgotPasswordBox')?.classList.remove('hidden');
        }
    
        // Password Validation Function
        function validatePassword(password) {
            const regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/;
            return regex.test(password);
        }
    
        // Register User
        async function register() {
           
            const emailField = document.getElementById("registerEmail");
            const passwordField = document.getElementById("registerPassword");
            const confirmPasswordField = document.getElementById("confirmPassword");
    
            if ( !emailField || !passwordField || !confirmPasswordField) {
                alert("Error: Some input fields are missing. Check your HTML.");
                return;
            }
    
            
            const email = emailField.value.trim();
            const password = passwordField.value.trim();
            const confirmPassword = confirmPasswordField.value.trim();
    
            if ( !email || !password || !confirmPassword) {
                alert("Please fill in all fields.");
                return;
            }
    
            if (!validatePassword(password)) {
                alert("Password must be at least 6 characters long, include uppercase, lowercase, numbers, and special characters.");
                return;
            }
    
            if (password !== confirmPassword) {
                alert("Passwords do not match!");
                return;
            }
    
            try {
                const response = await fetch(`${apiBaseUrl}/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
    
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem("userEmail", email);
                    alert("Registered successfully!");
                    showLogin();
                } else {
                    alert(`Registration failed! ${data.message || "Try again later."}`);
                }
            } catch (error) {
                console.error("Error during registration:", error);
                alert("Network error. Check your backend connection.");
            }
        }
    
        // Login User
        async function login() {
            const emailField = document.getElementById("loginEmail");
            const passwordField = document.getElementById("loginPassword");
    
            if (!emailField || !passwordField) {
                alert("Login form error. Please refresh the page.");
                return;
            }
    
            const email = emailField.value.trim();
            const password = passwordField.value.trim();
    
            try {
                const response = await fetch(`${apiBaseUrl}/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });
    
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem("userEmail", email);
                    alert("Login successful!");
                    window.location.href = "donorprofile1.html"; 
                } else {
                    alert(`Invalid credentials! ${data.message || ""}`);
                }
            } catch (error) {
                console.error("Login error:", error);
                alert("Network error. Check your backend connection.");
            }
        }
    
        // Send Reset Code
        async function sendResetCode() {
            const emailField = document.getElementById("resetEmail");
    
            if (!emailField) {
                alert("Error: Reset email field not found.");
                return;
            }
    
            const email = emailField.value.trim();
    
            try {
                const response = await fetch(`${apiBaseUrl}/forgot-password`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email })
                });
    
                if (response.ok) {
                    alert("Reset code sent to your email!");
                    document.getElementById("resetCode")?.classList.remove("hidden");
                    document.getElementById("newPassword")?.classList.remove("hidden");
                    document.getElementById("resetBtn")?.classList.remove("hidden");
                } else {
                    alert("Email not found!");
                }
            } catch (error) {
                console.error("Error in sending reset code:", error);
                alert("Network error. Check your backend connection.");
            }
        }
    
        // Reset Password
        async function resetPassword() {
            const resetCodeField = document.getElementById("resetCode");
            const newPasswordField = document.getElementById("newPassword");
    
            if (!resetCodeField || !newPasswordField) {
                alert("Reset form fields missing!");
                return;
            }
    
            const resetCode = resetCodeField.value.trim();
            const newPassword = newPasswordField.value.trim();
    
            if (!validatePassword(newPassword)) {
                alert("New password must be at least 6 characters long, including uppercase, lowercase, numbers, and special characters.");
                return;
            }
    
            try {
                const response = await fetch(`${apiBaseUrl}/reset-password/${resetCode}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ newPassword })
                });
    
                if (response.ok) {
                    alert("Password reset successfully!");
                    showLogin();
                } else {
                    alert("Invalid reset code!");
                }
            } catch (error) {
                console.error("Error in password reset:", error);
                alert("Network error. Check your backend connection.");
            }
        }
    
        // Attach functions to the global scope
        window.showRegister = showRegister;
        window.showLogin = showLogin;
        window.showForgotPassword = showForgotPassword;
        window.register = register;
        window.login = login;
        window.sendResetCode = sendResetCode;
        window.resetPassword = resetPassword;
    });
   </script>
    
   
</body>

</html>
